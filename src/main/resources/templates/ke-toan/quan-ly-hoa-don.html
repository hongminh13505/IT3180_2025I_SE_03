<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n l√Ω h√≥a ƒë∆°n - Qu·∫£n l√Ω chung c∆∞</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" th:href="@{/css/admin.css}">
</head>
<body>
    <div class="wrapper">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h3>BLUE MOON</h3>
                <p class="role-badge">K·∫ø to√°n</p>
            </div>
            
            <nav class="sidebar-menu">
                <ul>
                    <li>
                        <a href="/ke-toan/dashboard">
                            <img src="/images/img4.png" alt="Dashboard" style="width: 18px; height: 18px; margin-right: 12px;"> Dashboard
                        </a>
                    </li>
                    <li>
                        <a href="/ke-toan/quan-ly-hoa-don" class="active">
                            <img src="/images/hoa-don.png" alt="Qu·∫£n l√Ω h√≥a ƒë∆°n" style="width: 18px; height: 18px; margin-right: 12px;"> Qu·∫£n l√Ω h√≥a ƒë∆°n
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>
        <div class="main-content">
            <!-- Header -->
            <header class="header">
                <div class="header-left">
                    <button class="menu-toggle" onclick="toggleSidebar()">‚ò∞</button>
                    <h2>Qu·∫£n l√Ω h√≥a ƒë∆°n</h2>
                </div>
                
                <div class="header-right">
                    <div class="user-info">
                        <span>Xin ch√†o, <strong th:text="${username}">K·∫ø to√°n</strong></span>
                        <form th:action="@{/logout}" method="post" style="display: inline;">
                            <button type="submit" class="btn btn-sm btn-danger">ƒêƒÉng xu·∫•t</button>
                        </form>
                    </div>
                </div>
            </header>
            <main class="page-content">
                <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>
                <div th:if="${error}" class="alert alert-error" th:text="${error}"></div>
                
                <!-- Import errors detail -->
                <div th:if="${importErrors}" class="alert alert-warning">
                    <strong>Chi ti·∫øt l·ªói import:</strong>
                    <ul style="margin: 10px 0 0 20px;">
                        <li th:each="err : ${importErrors}" th:text="${err}"></li>
                    </ul>
                </div>
                <div class="content-header">
                    <div class="search-bar">
                        <form th:action="@{/ke-toan/quan-ly-hoa-don}" method="get" id="searchForm">
                            <input type="text" name="search" th:value="${search}" placeholder="T√¨m ki·∫øm..." class="form-control">
                            <input type="hidden" name="page" value="0">
                            <input type="hidden" name="loaiHoaDon" th:value="${loaiHoaDon}" id="loaiHoaDonInput">
                            <input type="hidden" name="trangThai" th:value="${trangThai}" id="trangThaiInput">
                            <input type="hidden" name="tuNgay" th:value="${tuNgay}" id="tuNgayInput">
                            <input type="hidden" name="denNgay" th:value="${denNgay}" id="denNgayInput">
                            <button type="submit" class="btn btn-primary">T√¨m ki·∫øm</button>
                        </form>
                    </div>
                    <div class="action-buttons" style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <!-- Import/Export Dropdown -->
                        <div class="dropdown">
                            <button class="btn btn-info dropdown-toggle" type="button" onclick="toggleImportExportDropdown()">
                                Import / Export
                            </button>
                            <ul class="dropdown-menu" id="importExportDropdownMenu">
                                <li><a class="dropdown-item" th:href="@{/ke-toan/quan-ly-hoa-don/export/excel(search=${search}, loaiHoaDon=${loaiHoaDon}, trangThai=${trangThai}, tuNgay=${tuNgay}, denNgay=${denNgay})}" style="display: flex; align-items: center; gap: 8px;">
                                    <img src="/images/excel.png" alt="Excel" style="width: 18px; height: 18px;"> Xu·∫•t Excel
                                </a></li>
                                <li><a class="dropdown-item" th:href="@{/ke-toan/quan-ly-hoa-don/export/pdf(search=${search}, loaiHoaDon=${loaiHoaDon}, trangThai=${trangThai}, tuNgay=${tuNgay}, denNgay=${denNgay})}" style="display: flex; align-items: center; gap: 8px;">
                                    <img src="/images/pdf.png" alt="PDF" style="width: 18px; height: 18px;"> Xu·∫•t PDF
                                </a></li>
                                <li style="border-top: 1px solid #e2e8f0; margin: 5px 0;"></li>
                                <li><a class="dropdown-item" th:href="@{/ke-toan/quan-ly-hoa-don/import/template}">T·∫£i m·∫´u Import</a></li>
                                <li><a class="dropdown-item" href="#" onclick="document.getElementById('importModal').style.display='flex'; return false;">Import t·ª´ Excel</a></li>
                            </ul>
                        </div>
                        
                        <!-- Create Invoice Dropdown -->
                        <div class="dropdown">
                            <button class="btn btn-success dropdown-toggle" type="button" id="createInvoiceDropdown" onclick="toggleDropdown()">
                                <img src="/images/add.png" alt="T·∫°o h√≥a ƒë∆°n" style="width: 18px; height: 18px; filter: brightness(0) invert(1); margin-right: 0px; vertical-align: middle;"> T·∫°o h√≥a ƒë∆°n
                            </button>
                            <ul class="dropdown-menu" id="dropdownMenu">
                                <li><a class="dropdown-item" href="/ke-toan/quan-ly-hoa-don/tao-hoa-don?loai=dien_nuoc">‚ö° ƒêi·ªán n∆∞·ªõc</a></li>
                                <li><a class="dropdown-item" href="/ke-toan/quan-ly-hoa-don/tao-hoa-don?loai=dich_vu">üõ†Ô∏è D·ªãch v·ª•</a></li>
                                <li><a class="dropdown-item" href="/ke-toan/quan-ly-hoa-don/tao-hoa-don?loai=sua_chua">üîß S·ª≠a ch·ªØa</a></li>
                                <li><a class="dropdown-item" href="/ke-toan/quan-ly-hoa-don/tao-hoa-don?loai=phat">‚ÄºÔ∏è Ph·∫°t</a></li>
                                <li><a class="dropdown-item" href="/ke-toan/quan-ly-hoa-don/tao-hoa-don?loai=khac">üìÑ Kh√°c</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="filter-section" style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);">
                    <h3 style="margin: 0 0 16px 0; font-size: 16px; font-weight: 600; color: #1e293b;">B·ªô l·ªçc</h3>
                    <form th:action="@{/ke-toan/quan-ly-hoa-don}" method="get" id="filterForm">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; align-items: end;">
                            <div>
                                <label style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 500; color: #475569;">Lo·∫°i h√≥a ƒë∆°n</label>
                                <select name="loaiHoaDon" class="form-control" style="width: 100%;">
                                    <option value="">T·∫•t c·∫£</option>
                                    <option value="dien_nuoc" th:selected="${loaiHoaDon == 'dien_nuoc'}">ƒêi·ªán n∆∞·ªõc</option>
                                    <option value="dich_vu" th:selected="${loaiHoaDon == 'dich_vu'}">D·ªãch v·ª•</option>
                                    <option value="sua_chua" th:selected="${loaiHoaDon == 'sua_chua'}">S·ª≠a ch·ªØa</option>
                                    <option value="phat" th:selected="${loaiHoaDon == 'phat'}">Ph·∫°t</option>
                                    <option value="khac" th:selected="${loaiHoaDon == 'khac'}">Kh√°c</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 500; color: #475569;">Tr·∫°ng th√°i</label>
                                <select name="trangThai" class="form-control" style="width: 100%;">
                                    <option value="">T·∫•t c·∫£</option>
                                    <option value="da_thanh_toan" th:selected="${trangThai == 'da_thanh_toan'}">ƒê√£ thanh to√°n</option>
                                    <option value="chua_thanh_toan" th:selected="${trangThai == 'chua_thanh_toan'}">Ch∆∞a thanh to√°n</option>
                                    <option value="qua_han" th:selected="${trangThai == 'qua_han'}">Qu√° h·∫°n</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 500; color: #475569;">T·ª´ ng√†y</label>
                                <input type="date" name="tuNgay" th:value="${tuNgay}" class="form-control" style="width: 100%;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 500; color: #475569;">ƒê·∫øn ng√†y</label>
                                <input type="date" name="denNgay" th:value="${denNgay}" class="form-control" style="width: 100%;">
                            </div>
                            <div style="display: flex; gap: 8px;">
                                <button type="submit" class="btn btn-primary" style="flex: 1;">L·ªçc</button>
                                <a th:href="@{/ke-toan/quan-ly-hoa-don}" class="btn btn-secondary" style="flex: 1; text-align: center; text-decoration: none; display: flex; align-items: center; justify-content: center;">X√≥a l·ªçc</a>
                            </div>
                        </div>
                        <input type="hidden" name="search" th:value="${search}">
                        <input type="hidden" name="page" value="0">
                    </form>
                </div>
                
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>M√É H√ìA ƒê∆†N</th>
                                <th>M√É H·ªò</th>
                                <th>LO·∫†I H√ìA ƒê∆†N</th>
                                <th>S·ªê TI·ªÄN</th>
                                <th>H·∫†N THANH TO√ÅN</th>
                                <th>TR·∫†NG TH√ÅI</th>
                                <th>THAO T√ÅC</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:if="${hoaDonList.isEmpty()}">
                                <td colspan="7" style="text-align: center; color: #94a3b8;">Kh√¥ng c√≥ h√≥a ƒë∆°n n√†o</td>
                            </tr>
                            <tr th:each="hoaDon : ${hoaDonList}">
                                <td th:text="${hoaDon.maHoaDon}">HD001</td>
                                <td th:text="${hoaDon.maHo}">H001</td>
                                <td>
                                    <span th:switch="${hoaDon.loaiHoaDon}">
                                        <span th:case="'dien_nuoc'" style="color: #4894ec;">ƒêi·ªán n∆∞·ªõc</span>
                                        <span th:case="'dich_vu'" style="color: #ec4899;">D·ªãch v·ª•</span>
                                        <span th:case="'sua_chua'" style="color: #8b5cf6;">S·ª≠a ch·ªØa</span>
                                        <span th:case="'phat'" style="color: #ef4444;">Ph·∫°t</span>
                                        <span th:case="'khac'" style="color: #6b7280;">Kh√°c</span>
                                        <span th:case="null" style="color: #6b7280;"> Kh√°c</span>
                                        <span th:case="''" style="color: #6b7280;"> Kh√°c</span>
                                        <span th:case="*" style="color: #6b7280;"> Kh√°c</span>
                                    </span>
                                </td>
                                <td>
                                    <span th:text="${#numbers.formatDecimal(hoaDon.soTien != null ? hoaDon.soTien : 0, 0, 'COMMA', 0, 'POINT')} + ' VNƒê'">0 VNƒê</span>
                                </td>
                                <td th:text="${hoaDon.hanThanhToan != null ? #temporals.format(hoaDon.hanThanhToan, 'dd/MM/yyyy') : 'N/A'}">01/01/2024</td>
                                <td>
                                    <span class="badge" 
                                          th:classappend="${hoaDon.trangThai == 'da_thanh_toan'} ? 'badge-success' : (${hoaDon.trangThai == 'qua_han'} ? 'badge-danger' : 'badge-warning')">
                                        <span th:switch="${hoaDon.trangThai}">
                                            <span th:case="'da_thanh_toan'">‚úì ƒê√£ thanh to√°n</span>
                                            <span th:case="'chua_thanh_toan'">Ch∆∞a thanh to√°n</span>
                                            <span th:case="'qua_han'">‚ö†Ô∏è Qu√° h·∫°n</span>
                                            <span th:case="*">Ch∆∞a thanh to√°n</span>
                                        </span>
                                    </span>
                                </td>
                                <td class="actions">
                                    <form th:action="@{/ke-toan/quan-ly-hoa-don/xoa/{id}(id=${hoaDon.maHoaDon})}" method="post" style="display: inline;">
                                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                                        <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a?')">X√≥a</button>
                                    </form>
                                </td>
                            </tr>
                    </tbody>
                </table>
            </div>
            
            <div th:if="${hoaDonPage != null and hoaDonPage.totalElements > 0}" class="pagination-container">
                <div class="pagination-info">
                    Hi·ªÉn th·ªã <strong th:text="${(currentPage * 20) + 1}">1</strong> - 
                    <strong th:text="${(currentPage * 20) + hoaDonList.size()}">20</strong> 
                    trong t·ªïng s·ªë <strong th:text="${totalElements}">0</strong> h√≥a ƒë∆°n
                </div>
                <div class="pagination" th:if="${totalPages > 1}">
                    <a th:href="@{/ke-toan/quan-ly-hoa-don(page=0, search=${search}, loaiHoaDon=${loaiHoaDon}, trangThai=${trangThai}, tuNgay=${tuNgay}, denNgay=${denNgay})}" 
                       class="pagination-btn"
                       th:classappend="${currentPage == 0} ? 'disabled' : ''"
                       th:onclick="${currentPage == 0} ? 'return false;' : ''">¬´ ƒê·∫ßu</a>
                    <a th:href="@{/ke-toan/quan-ly-hoa-don(page=${currentPage - 1}, search=${search}, loaiHoaDon=${loaiHoaDon}, trangThai=${trangThai}, tuNgay=${tuNgay}, denNgay=${denNgay})}" 
                       class="pagination-btn"
                       th:classappend="${currentPage == 0} ? 'disabled' : ''"
                       th:onclick="${currentPage == 0} ? 'return false;' : ''">‚Äπ</a>
                    <span th:if="${totalPages <= 10}">
                        <a th:each="pageNum : ${#numbers.sequence(0, totalPages - 1)}"
                           th:href="@{/ke-toan/quan-ly-hoa-don(page=${pageNum}, search=${search}, loaiHoaDon=${loaiHoaDon}, trangThai=${trangThai}, tuNgay=${tuNgay}, denNgay=${denNgay})}" 
                           class="pagination-btn"
                           th:classappend="${pageNum == currentPage} ? 'active' : ''"
                           th:text="${pageNum + 1}">1</a>
                    </span>
                    <span th:if="${totalPages > 10}">
                        <a th:href="@{/ke-toan/quan-ly-hoa-don(page=0, search=${search}, loaiHoaDon=${loaiHoaDon}, trangThai=${trangThai}, tuNgay=${tuNgay}, denNgay=${denNgay})}" 
                           class="pagination-btn"
                           th:classappend="${currentPage == 0} ? 'active' : ''">1</a>
                        <span th:if="${currentPage > 3}"><span class="pagination-ellipsis">...</span></span>
                        <span th:if="${currentPage > 2 and currentPage < totalPages - 3}">
                            <a th:each="pageNum : ${#numbers.sequence(currentPage - 1, currentPage + 1)}"
                               th:href="@{/ke-toan/quan-ly-hoa-don(page=${pageNum}, search=${search}, loaiHoaDon=${loaiHoaDon}, trangThai=${trangThai}, tuNgay=${tuNgay}, denNgay=${denNgay})}" 
                               class="pagination-btn"
                               th:classappend="${pageNum == currentPage} ? 'active' : ''"
                               th:text="${pageNum + 1}">5</a>
                        </span>
                        <span th:if="${currentPage <= 2}">
                            <a th:each="pageNum : ${#numbers.sequence(1, 3)}"
                               th:href="@{/ke-toan/quan-ly-hoa-don(page=${pageNum}, search=${search}, loaiHoaDon=${loaiHoaDon}, trangThai=${trangThai}, tuNgay=${tuNgay}, denNgay=${denNgay})}" 
                               class="pagination-btn"
                               th:classappend="${pageNum == currentPage} ? 'active' : ''"
                               th:text="${pageNum + 1}">2</a>
                        </span>
                        <span th:if="${currentPage >= totalPages - 3}">
                            <a th:each="pageNum : ${#numbers.sequence(totalPages - 4, totalPages - 2)}"
                               th:href="@{/ke-toan/quan-ly-hoa-don(page=${pageNum}, search=${search}, loaiHoaDon=${loaiHoaDon}, trangThai=${trangThai}, tuNgay=${tuNgay}, denNgay=${denNgay})}" 
                               class="pagination-btn"
                               th:classappend="${pageNum == currentPage} ? 'active' : ''"
                               th:text="${pageNum + 1}">10</a>
                        </span>
                        <span th:if="${currentPage < totalPages - 4}"><span class="pagination-ellipsis">...</span></span>
                        <a th:href="@{/ke-toan/quan-ly-hoa-don(page=${totalPages - 1}, search=${search}, loaiHoaDon=${loaiHoaDon}, trangThai=${trangThai}, tuNgay=${tuNgay}, denNgay=${denNgay})}" 
                           class="pagination-btn"
                           th:classappend="${currentPage == totalPages - 1} ? 'active' : ''"
                           th:text="${totalPages}">10</a>
                    </span>
                    <a th:href="@{/ke-toan/quan-ly-hoa-don(page=${currentPage + 1}, search=${search}, loaiHoaDon=${loaiHoaDon}, trangThai=${trangThai}, tuNgay=${tuNgay}, denNgay=${denNgay})}" 
                       class="pagination-btn"
                       th:classappend="${currentPage >= totalPages - 1} ? 'disabled' : ''"
                       th:onclick="${currentPage >= totalPages - 1} ? 'return false;' : ''">‚Ä∫</a>
                    <a th:href="@{/ke-toan/quan-ly-hoa-don(page=${totalPages - 1}, search=${search}, loaiHoaDon=${loaiHoaDon}, trangThai=${trangThai}, tuNgay=${tuNgay}, denNgay=${denNgay})}" 
                       class="pagination-btn"
                       th:classappend="${currentPage >= totalPages - 1} ? 'disabled' : ''"
                       th:onclick="${currentPage >= totalPages - 1} ? 'return false;' : ''">Cu·ªëi ¬ª</a>
                </div>
            </div>
            </main>
        </div>
    </div>
    
    <!-- Import Modal -->
    <div id="importModal" class="modal-overlay" style="display: none;">
        <div class="modal-content import-modal-content">
            <div class="modal-header import-modal-header">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <div style="width: 48px; height: 48px; background: linear-gradient(135deg, #10b981, #059669); border-radius: 12px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);">
                        <img src="/images/excel.png" alt="Excel" style="width: 28px; height: 28px; filter: brightness(0) invert(1);">
                    </div>
                    <div>
                        <h3 style="margin: 0; color: #1e293b; font-size: 24px; font-weight: 600;">Import h√≥a ƒë∆°n t·ª´ Excel</h3>
                        <p style="margin: 4px 0 0 0; color: #64748b; font-size: 14px;">T·∫£i l√™n file Excel ƒë·ªÉ import d·ªØ li·ªáu h√≥a ƒë∆°n</p>
                    </div>
                </div>
                <button type="button" class="modal-close" onclick="document.getElementById('importModal').style.display='none'">&times;</button>
            </div>
            <form th:action="@{/ke-toan/quan-ly-hoa-don/import}" method="post" enctype="multipart/form-data">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                <div class="modal-body import-modal-body">
                    <!-- File Upload Section -->
                    <div class="file-upload-section">
                        <label for="importFile" class="file-upload-label">
                            <div class="file-upload-box">
                                <div style="text-align: center;">
                                    <div style="width: 64px; height: 64px; margin: 0 auto 16px; background: linear-gradient(135deg, #f0f9ff, #e0f2fe); border-radius: 16px; display: flex; align-items: center; justify-content: center;">
                                        <img src="/images/excel.png" alt="Excel" style="width: 36px; height: 36px;">
                                    </div>
                                    <p style="margin: 0 0 8px 0; font-size: 16px; font-weight: 600; color: #1e293b;">
                                        Ch·ªçn file Excel ƒë·ªÉ import
                                    </p>
                                    <p style="margin: 0; font-size: 14px; color: #64748b;">
                                        H·ªó tr·ª£ ƒë·ªãnh d·∫°ng: .xlsx, .xls
                                    </p>
                                </div>
                            </div>
                            <input type="file" id="importFile" name="file" accept=".xlsx,.xls" required 
                                   style="display: none;" onchange="handleFileSelect(event)">
                        </label>
                        <div id="selectedFileInfo" style="display: none; margin-top: 16px; padding: 16px; background: linear-gradient(135deg, #f0fdf4, #dcfce7); border-radius: 12px; border: 2px solid #10b981;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <img src="/images/excel.png" alt="Excel" style="width: 32px; height: 32px;">
                                <div style="flex: 1;">
                                    <p style="margin: 0; font-weight: 600; color: #059669; font-size: 15px;" id="fileNameText"></p>
                                    <p style="margin: 4px 0 0 0; font-size: 13px; color: #047857;" id="fileSizeText"></p>
                                </div>
                                <button type="button" onclick="clearFile()" style="background: none; border: none; color: #ef4444; cursor: pointer; font-size: 20px; padding: 4px 8px; border-radius: 4px; transition: background 0.2s;" onmouseover="this.style.background='#fee2e2'" onmouseout="this.style.background='none'">&times;</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Action -->
                    <div style="margin-top: 24px;">
                        <a th:href="@{/ke-toan/quan-ly-hoa-don/import/template}" 
                           class="btn-template-download" 
                           style="display: flex; align-items: center; justify-content: center; gap: 10px; text-decoration: none; padding: 14px 24px; background: linear-gradient(135deg, #64748b, #475569); color: white; border-radius: 10px; font-weight: 500; transition: all 0.2s; box-shadow: 0 2px 8px rgba(100, 116, 139, 0.2);"
                           onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(100, 116, 139, 0.3)'"
                           onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(100, 116, 139, 0.2)'">
                            <img src="/images/excel.png" alt="Excel" style="width: 20px; height: 20px; filter: brightness(0) invert(1);"> T·∫£i file m·∫´u Import
                        </a>
                    </div>
                    
                    <!-- Instructions Section -->
                    <div class="import-info" style="background: linear-gradient(135deg, #f0f9ff, #e0f2fe); padding: 24px; border-radius: 12px; margin-top: 24px; border-left: 4px solid #0ea5e9;">
                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                            <div style="width: 36px; height: 36px; background: linear-gradient(135deg, #0ea5e9, #0284c7); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 8px rgba(14, 165, 233, 0.3);">
                                <span style="color: white; font-size: 18px; font-weight: bold;">!</span>
                            </div>
                            <h4 style="margin: 0; color: #0369a1; font-size: 18px; font-weight: 600;">H∆∞·ªõng d·∫´n Import</h4>
                        </div>
                        <ul style="margin: 0; padding-left: 24px; color: #0c4a6e; line-height: 2;">
                            <li style="margin-bottom: 8px;">T·∫£i file m·∫´u tr∆∞·ªõc khi import ƒë·ªÉ ƒë·∫£m b·∫£o ƒë·ªãnh d·∫°ng ƒë√∫ng</li>
                            <li style="margin-bottom: 8px;">ƒêi·ªÅn ƒë·∫ßy ƒë·ªß c√°c tr∆∞·ªùng b·∫Øt bu·ªôc (ƒë√°nh d·∫•u *)</li>
                            <li style="margin-bottom: 8px;"><strong>ƒê·ªãnh d·∫°ng ng√†y:</strong> dd/MM/yyyy (v√≠ d·ª•: 01/01/2024)</li>
                            <li style="margin-bottom: 8px;"><strong>Lo·∫°i h√≥a ƒë∆°n:</strong> dien_nuoc, dich_vu, sua_chua, phat, khac</li>
                            <li style="margin-bottom: 8px;"><strong>Tr·∫°ng th√°i:</strong> da_thanh_toan, chua_thanh_toan, qua_han</li>
                            <li style="margin-bottom: 0;"><strong>S·ªë ti·ªÅn:</strong> ƒê·ªãnh d·∫°ng s·ªë (kh√¥ng c√≥ d·∫•u ph·∫©y ho·∫∑c ch·∫•m)</li>
                        </ul>
                    </div>
                </div>
                <div class="modal-footer import-modal-footer">
                    <button type="button" class="btn btn-outline" onclick="document.getElementById('importModal').style.display='none'; clearFile();">
                        H·ªßy
                    </button>
                    <button type="submit" class="btn btn-primary" id="submitBtn" disabled style="display: flex; align-items: center; gap: 8px;">
                        <img src="/images/excel.png" alt="Excel" style="width: 18px; height: 18px; filter: brightness(0) invert(1);"> Import
                    </button>
                </div>
            </form>
        </div>
    </div>

    <style>
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal-content {
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            max-width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        .import-modal-content {
            max-width: 750px;
            width: 90%;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #e2e8f0;
        }
        .import-modal-header {
            padding: 28px 32px;
            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
            border-bottom: 2px solid #e2e8f0;
        }
        .modal-header h3 {
            margin: 0;
            color: #1e293b;
        }
        .modal-body {
            padding: 20px;
        }
        .import-modal-body {
            padding: 32px;
        }
        .file-upload-section {
            margin-bottom: 24px;
        }
        .file-upload-label {
            display: block;
            cursor: pointer;
        }
        .file-upload-box {
            border: 3px dashed #cbd5e1;
            border-radius: 16px;
            background: #f8fafc;
            padding: 40px 20px;
            transition: all 0.3s ease;
        }
        .file-upload-label:hover .file-upload-box {
            border-color: #0ea5e9;
            background: #f0f9ff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(14, 165, 233, 0.15);
        }
        .modal-footer {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }
        .import-modal-footer {
            padding: 24px 32px;
            border-top: 1px solid #e2e8f0;
            background: #f8fafc;
        }
        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #64748b;
            transition: color 0.2s;
        }
        .modal-close:hover {
            color: #ef4444;
        }
        .btn-info {
            background: linear-gradient(135deg, #0ea5e9, #0284c7);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }
        .btn-info:hover {
            background: linear-gradient(135deg, #0284c7, #0369a1);
            transform: translateY(-1px);
        }
        .btn-outline {
            background: white;
            color: #64748b;
            border: 1px solid #e2e8f0;
            padding: 10px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-outline:hover {
            background: #f1f5f9;
            border-color: #cbd5e1;
        }
        .btn-primary {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            font-size: 15px;
        }
        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        .btn-primary:disabled:hover {
            transform: none;
        }
        .alert-warning {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border-left: 4px solid #f59e0b;
            color: #92400e;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .dropdown {
            position: relative;
            display: inline-block;
        }
        .dropdown-menu {
            display: none;
            position: absolute;
            background-color: white;
            min-width: 200px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1;
            border-radius: 8px;
            padding: 8px 0;
            margin-top: 5px;
            border: 1px solid #e2e8f0;
        }
        .dropdown-menu.show {
            display: block;
        }
        .dropdown-item {
            color: #334155;
            padding: 10px 16px;
            text-decoration: none;
            display: block;
            transition: background-color 0.2s;
        }
        .dropdown-item:hover {
            background-color: #f1f5f9;
        }
        .dropdown-toggle::after {
            content: ' ‚ñº';
            font-size: 10px;
            margin-left: 5px;
        }
        .pagination-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 24px;
            padding: 20px 24px;
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06), 0 1px 3px rgba(0, 0, 0, 0.04);
            flex-wrap: wrap;
            gap: 20px;
            border: 1px solid rgba(226, 232, 240, 0.8);
        }
        .pagination-info {
            color: #475569;
            font-size: 14px;
            font-weight: 500;
        }
        .pagination-info strong {
            color: #1e293b;
            font-weight: 600;
        }
        .pagination {
            display: flex;
            gap: 6px;
            align-items: center;
            flex-wrap: wrap;
        }
        .pagination-btn {
            padding: 10px 14px;
            text-decoration: none;
            border-radius: 8px;
            background: white;
            border: 1.5px solid #e2e8f0;
            color: #475569;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            min-width: 42px;
            height: 42px;
            text-align: center;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
        }
        .pagination-btn:hover:not(.disabled):not(.active) {
            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
            border-color: #cbd5e1;
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
            color: #1e293b;
        }
        .pagination-btn.active {
            background: linear-gradient(135deg, #0ea5e9, #0284c7);
            color: white;
            border-color: #0284c7;
            font-weight: 600;
            box-shadow: 0 4px 14px rgba(14, 165, 233, 0.35), 0 2px 4px rgba(14, 165, 233, 0.2);
            transform: translateY(-1px) scale(1.05);
        }
        .pagination-btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
            transform: none;
            box-shadow: none;
        }
        .pagination-ellipsis {
            padding: 8px 0;
            color: #64748b;
            font-size: 14px;
            font-weight: 500;
        }
    </style>

    <script th:src="@{/js/script.js}"></script>
    <script>
        function toggleDropdown() {
            const dropdownMenu = document.getElementById('dropdownMenu');
            const importExportMenu = document.getElementById('importExportDropdownMenu');
            importExportMenu.classList.remove('show');
            dropdownMenu.classList.toggle('show');
        }
        
        function toggleImportExportDropdown() {
            const importExportMenu = document.getElementById('importExportDropdownMenu');
            const dropdownMenu = document.getElementById('dropdownMenu');
            dropdownMenu.classList.remove('show');
            importExportMenu.classList.toggle('show');
        }
        
        document.addEventListener('click', function(event) {
            const dropdowns = document.querySelectorAll('.dropdown');
            let clickedInside = false;
            
            dropdowns.forEach(function(dropdown) {
                if (dropdown.contains(event.target)) {
                    clickedInside = true;
                }
            });
            
            if (!clickedInside) {
                document.getElementById('dropdownMenu').classList.remove('show');
                document.getElementById('importExportDropdownMenu').classList.remove('show');
            }
        });
        
        // File upload handling
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                const fileName = file.name;
                const fileSize = (file.size / 1024 / 1024).toFixed(2);
                document.getElementById('fileNameText').textContent = fileName;
                document.getElementById('fileSizeText').textContent = fileSize + ' MB';
                document.getElementById('selectedFileInfo').style.display = 'block';
                document.getElementById('submitBtn').disabled = false;
                
                // Update upload box
                const uploadBox = document.querySelector('.file-upload-box');
                uploadBox.style.borderColor = '#10b981';
                uploadBox.style.background = '#f0fdf4';
            }
        }
        
        function clearFile() {
            document.getElementById('importFile').value = '';
            document.getElementById('selectedFileInfo').style.display = 'none';
            document.getElementById('submitBtn').disabled = true;
            const uploadBox = document.querySelector('.file-upload-box');
            if (uploadBox) {
                uploadBox.style.borderColor = '#cbd5e1';
                uploadBox.style.background = '#f8fafc';
            }
        }
        
        // Close modal when clicking outside
        document.getElementById('importModal').addEventListener('click', function(event) {
            if (event.target === this) {
                this.style.display = 'none';
                clearFile();
            }
        });
    </script>
</body>
</html>

